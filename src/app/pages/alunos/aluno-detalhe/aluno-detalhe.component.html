<div class="container mt-4" *ngIf="aluno$ | async as aluno; else loading">

  <div class="card shadow-sm mb-4">
    <div class="card-header d-flex justify-content-between align-items-center">
      <h4 class="mb-0">
        <i class="bi bi-person-badge"></i> {{ aluno.nome }}
        <span *ngIf="aluno.nomeSocial" class="text-muted fs-6"> ({{ aluno.nomeSocial }})</span>
      </h4>
      <a [routerLink]="['/alunos/editar', aluno.id]" class="btn btn-outline-primary btn-sm">
        <i class="bi bi-pencil-fill"></i> Editar Aluno
      </a>
    </div>
    <div class="card-body">
      <div class="row">
        <div class="col-md-6">
          <p><strong>Matrícula:</strong> {{ aluno.matricula }}</p>
          <p><strong>Curso:</strong> {{ aluno.curso.nome }}</p>
          <p><strong>Turma:</strong> {{ aluno.turma.nome }}</p>
        </div>
        <div class="col-md-6">
          <p>
            <strong>Prioridade:</strong>
            <span [class.text-danger]="aluno.prioridadeAtendimento">
              {{ aluno.prioridadeAtendimento ? 'Sim' : 'Não' }}
            </span>
          </p>
          <p><strong>Diagnósticos:</strong></p>
          <ul *ngIf="aluno.diagnosticos.length > 0; else noDiag">
            <li *ngFor="let diag of aluno.diagnosticos">
              {{ diag.sigla }} - {{ diag.nome }}
            </li>
          </ul>
          <ng-template #noDiag><p class="text-muted">Nenhum diagnóstico associado.</p></ng-template>
        </div>
      </div>
    </div>
  </div>

  <div class="card shadow-sm">
    <div class="card-header d-flex justify-content-between align-items-center">
      <h4 class="mb-0"><i class="bi bi-calendar-check"></i> Atendimentos</h4>
      <button class="btn btn-success" (click)="showAtendimentoForm = !showAtendimentoForm">
        <i class="bi bi-plus-lg"></i>
        {{ showAtendimentoForm ? 'Cancelar Atendimento' : 'Novo Atendimento' }}
      </button>
    </div>

    <div class="card-body">
      <div *ngIf="showAtendimentoForm" class="mb-4 p-3 border rounded bg-light">
        <app-atendimento-form
          [alunoId]="aluno.id"
          (atendimentoSalvo)="onAtendimentoSalvo()">
        </app-atendimento-form>
      </div>

      <app-atendimento-list [alunoId]="aluno.id"></app-atendimento-list>
    </div>
  </div>

</div>

<ng-template #loading>
  <div class="text-center mt-5">
    <div class="spinner-border" style="width: 3rem; height: 3rem;" role="status">
      <span class="visually-hidden">Carregando dados do aluno...</span>
    </div>
  </div>
</ng-template>
